{% extends "base.html" %}

{% block title %}Yönetici Paneli{% endblock %}

{% block body_class %}anasayfa-bg{% endblock %}

{% block content %}
<div class="profile-container">
    <h2 class="profile-header">Yönetici Paneli (Merhaba, {{ current_user.username }})</h2>
    
    <div class="profile-info">
        <p><strong>Giriş Başarılı.</strong> Bu alan, dersleri yükleyeceğin ve kullanıcıları yöneteceğin Yönetici Kontrol Paneli olacak.</p>
        <p>E-posta Adresi: {{ current_user.email }}</p>
    </div>

    <hr style="border-top: 1px solid #444; margin-top: 20px; margin-bottom: 30px;">

    <h3>Yeni Ders İçeriği Yükle</h3>
    
    <!-- KRİTİK ÇÖZÜM: Form standart hale getirildi, TinyMCE referansları kaldırıldı -->
    <form action="{{ url_for('ders_yukle') }}" method="POST"> 
        
        <div class="form-group">
            <label for="title">Ders Başlığı (Örn: Python'da İlk Adımlar)</label>
            <input type="text" id="title" name="title" required>
        </div>

        <div class="form-group">
            <label for="main_category">1. Ana Kategori (Görüntülenecek Sayfa):</label>
            <select id="main_category" name="main_category" required>
                <option value="egitim">Yazılım/Eğitim</option>
                <option value="gomulu">Gömülü Sistemler</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="sub_category">2. Alt Konu Etiketi (Örn: Python, C++, Arduino):</label>
            <input type="text" id="sub_category" name="sub_category" required>
        </div>

        <div class="form-group">
            <label for="description">Kart Açıklaması (Kısa özet):</label>
            <textarea id="description" name="description" required rows="2"></textarea>
        </div>

        <div class="form-group" style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <label for="level">Seviye:</label>
                <select id="level" name="level">
                    <option value="Başlangıç">Başlangıç</option>
                    <option value="Orta">Orta</option>
                    <option value="İleri">İleri</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label for="lesson_count">Modül Sayısı:</label>
                <input type="number" id="lesson_count" name="lesson_count" value="1" min="1">
            </div>
        </div>
        
        <div class="form-group">
            <label for="slug">URL Kısaltması (Örn: python-ilk-adimlar)</label>
            <input type="text" id="slug" name="slug" required>
        </div>

        <!-- DERS İÇERİĞİ: Standart, düz metin/Markdown girişi için textarea -->
        <div class="form-group">
            <label for="content">Ders İçeriği (Markdown formatında girin):</label>
            <textarea id="content" name="content" required rows="15"></textarea>
        </div>
        
        <!-- Buton tekrar submit type oldu -->
        <button type="submit" class="submit-btn">Dersi Kaydet ve Yayımla</button>
    </form>
    
    <hr style="border-top: 1px solid #444; margin-top: 30px;">
    
    <!-- YAYINLANMIŞ DERSLERİ YÖNETME KISMI -->
    <h3>Yayınlanmış Dersleri Yönet ({{ all_lessons|length }} Ders)</h3>

    <div class="lesson-management">
        {% if all_lessons %}
            {% for lesson in all_lessons %}
                <div class="list-item-management">
                    <p style="margin: 0;">
                        <strong>{{ lesson.title }}</strong> 
                        <span style="opacity: 0.7; font-size: 0.9em;">
                            ({{ lesson.main_category|upper }} / {{ lesson.sub_category }} / {{ lesson.created_at.strftime('%d %b') }})
                        </span>
                    </p>
                    <div class="actions">
                        <a href="{{ url_for('ders_sil', lesson_id=lesson.id) }}" 
                           class="cta-button" 
                           style="background-color: #e74c3c; padding: 5px 10px; font-size: 0.9em; text-decoration: none;"
                           onclick="return confirm('Emin misiniz? Ders kalıcı olarak silinecektir: {{ lesson.title }}')">
                            Sil
                        </a>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p style="opacity: 0.7; padding-top: 10px;">Henüz yayınlanmış dersiniz yok.</p>
        {% endif %}
    </div>

</div>

<!-- Sayfa sonundaki TinyMCE script'leri SİLİNMELİDİR -->
<!-- (Eğer bu kod base.html'den türetiliyorsa, bu kısım da base.html'de olmamalıdır.) -->
<style>
    /* Yönetici Paneli CSS'leri (Gerekli stiller bu blokta tutulur) */
    .profile-container {
        max-width: 900px;
        margin: 50px auto;
        padding: 30px;
        background-color: var(--kod-kutu-bg);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 189, 212, 0.4);
    }
    .profile-header {
        color: var(--vurgu-renk);
        border-bottom: 2px solid #333;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: var(--vurgu-renk);
    }
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #444;
        background-color: #333;
        color: var(--yazi-renk);
        border-radius: 4px;
        box-sizing: border-box;
    }
    .form-group textarea {
        min-height: 200px;
        font-family: 'Consolas', monospace; /* Monospace font, kod yazımını kolaylaştırır */
    }
    .submit-btn {
        background-color: var(--vurgu-renk);
        color: var(--arka-alan);
        padding: 12px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s;
    }
    .submit-btn:hover {
        background-color: #00a4b4;
    }
    .list-item-management {
        border-bottom: 1px solid #333;
        padding: 10px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
</style>
{% endblock %}